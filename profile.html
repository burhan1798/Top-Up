<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color: white;
  overflow: hidden;
}

/* Neon bubble background */
body::before, body::after {
  content: "";
  position: absolute;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(0,255,200,0.4) 0%, transparent 70%);
  border-radius: 50%;
  animation: floatBubble 15s infinite ease-in-out alternate;
  z-index: 0;
}
body::after {
  width: 500px;
  height: 500px;
  left: auto;
  right: -150px;
  background: radial-gradient(circle, rgba(0,200,255,0.4) 0%, transparent 70%);
  animation-delay: 5s;
}

@keyframes floatBubble {
  0% { transform: translateY(0) translateX(0) scale(1); }
  50% { transform: translateY(-50px) translateX(30px) scale(1.1); }
  100% { transform: translateY(0) translateX(-20px) scale(1); }
}

.profile-container {
  position: relative;
  z-index: 1;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(15px);
  padding: 30px;
  border-radius: 20px;
  width: 360px;
  box-shadow: 0 0 25px rgba(0,255,200,0.3), 0 0 40px rgba(0,200,255,0.2);
  text-align: center;
  animation: fadeIn 1.2s ease;
}

@keyframes fadeIn { 
  from { opacity:0; transform:scale(0.9);} 
  to { opacity:1; transform:scale(1);} 
}

.profile-container img {
  width: 90px; height: 90px; border-radius: 50%;
  border: 3px solid #00ffc3;
  margin-bottom: 15px;
  cursor: pointer;
  box-shadow: 0 0 15px #00ffc3, 0 0 25px #00ccff;
  transition: 0.3s;
}
.profile-container img:hover {
  transform: scale(1.05) rotate(3deg);
  box-shadow: 0 0 25px #00ffc3, 0 0 45px #00ccff;
}

.profile-container input {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  outline: none;
  background: rgba(255,255,255,0.15);
  color: white;
  font-size: 14px;
  transition: 0.3s;
}
.profile-container input:focus {
  background: rgba(0,255,200,0.2);
  box-shadow: 0 0 10px rgba(0,255,200,0.4);
}
.profile-container input::placeholder { color: #ccc; }

button {
  width: 100%; 
  padding: 12px;
  margin-top: 10px;
  background: linear-gradient(45deg,#00ff99,#00ccff);
  border: none; border-radius: 8px;
  color: black; font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 10px rgba(0,255,200,0.4);
}
button:hover { 
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(0,255,200,0.7), 0 0 25px rgba(0,200,255,0.5);
}
</style>
</head>
<body>

<div class="profile-container">
  <h2>MY PROFILE</h2>
  <img id="profilePic" src="https://via.placeholder.com/90" alt="Profile Picture" title="Click to Change">
  <input type="file" id="profileUpload" accept="image/*" style="display:none;">
  
  <input type="text" id="fullname" placeholder="Full Name">
  <input type="text" id="username" placeholder="Username" readonly>
  <input type="text" id="phone" placeholder="Phone" readonly>
  <input type="email" id="email" placeholder="Email">

  <h3 style="margin-top:15px;">Change Password</h3>
  <input type="password" id="oldPassword" placeholder="Old Password">
  <input type="password" id="newPassword" placeholder="New Password">

  <button onclick="saveProfile()">Save Changes</button>
  <button style="background:#ff4444; color:white;" onclick="logoutUser()">Logout</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDwqM5xxcw-tX3ZoswIdl4HWVYdf7foNEY",
    authDomain: "bulla-bazar.firebaseapp.com",
    databaseURL: "https://bulla-bazar-default-rtdb.firebaseio.com",
    projectId: "bulla-bazar",
    storageBucket: "bulla-bazar.appspot.com",
    messagingSenderId: "597341196963",
    appId: "1:597341196963:web:af1f2cc7808a9f127d6516"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if(!currentUser){
    window.location.href="login.html";
  }

  let userKey = null;

  // Load profile info
  db.ref("users").orderByChild("phone").equalTo(currentUser.phone).once("value")
    .then(snapshot => {
      snapshot.forEach(child => {
        const u = child.val();
        userKey = child.key;

        document.getElementById("fullname").value = u.fullname || "";
        document.getElementById("username").value = u.username || "";
        document.getElementById("phone").value = u.phone || "";
        document.getElementById("email").value = u.email || "";
        if(u.profilePic){
          document.getElementById("profilePic").src = u.profilePic;
        }
      });
    });

  // Profile pic upload
  document.getElementById("profilePic").addEventListener("click", ()=>{
    document.getElementById("profileUpload").click();
  });
  document.getElementById("profileUpload").addEventListener("change", e=>{
    const file = e.target.files[0];
    if(!file || !userKey) return;
    const storageRef = storage.ref("profilePics/"+userKey+"_"+file.name);
    storageRef.put(file).then(snap=>{
      snap.ref.getDownloadURL().then(url=>{
        db.ref("users/"+userKey+"/profilePic").set(url);
        document.getElementById("profilePic").src = url;
        currentUser.profilePic = url;
        localStorage.setItem("currentUser", JSON.stringify(currentUser));
        alert("Profile picture updated!");
      });
    });
  });

  function saveProfile(){
    const fullname = document.getElementById("fullname").value.trim();
    const email = document.getElementById("email").value.trim();
    const oldPass = document.getElementById("oldPassword").value.trim();
    const newPass = document.getElementById("newPassword").value.trim();

    if(oldPass && oldPass !== currentUser.password){
      alert("Old password is incorrect!");
      return;
    }

    if(newPass){
      currentUser.password = newPass;
    }

    currentUser.fullname = fullname;
    currentUser.email = email;

    // Update Firebase
    db.ref("users/"+userKey).update({
      fullname: fullname,
      email: email,
      password: currentUser.password
    }).then(()=>{
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      alert("Profile updated successfully!");
      document.getElementById("oldPassword").value="";
      document.getElementById("newPassword").value="";
    });
  }

  function logoutUser(){
    localStorage.removeItem("currentUser");
    window.location.href="login.html";
  }
</script>

</body>
</html>
