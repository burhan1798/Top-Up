<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff9966, #ff5e62);
      margin: 0;
      color: white;
    }
    h2 { text-align: center; margin-top: 20px; }
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .tab-btn {
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      border: none;
      color: white;
      font-weight: bold;
    }
    .tab-btn.active { background: #00ff99; color: black; }
    .tab-content { display: none; padding: 10px; }
    .active-tab { display: block; }

    table {
      width: 95%;
      margin: 10px auto;
      border-collapse: collapse;
      background: rgba(0,0,0,0.2);
      backdrop-filter: blur(8px);
    }
    th, td {
      border: 1px solid white;
      padding: 8px;
      text-align: center;
    }
    th { background: rgba(255,255,255,0.1); }
    tr:nth-child(even) { background: rgba(255,255,255,0.05); }
    button.action {
      padding: 5px 10px;
      margin: 2px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .delete { background: red; color: white; }
    .complete { background: lime; color: black; }
    .fail { background: orange; color: black; }
  </style>
</head>
<body>
  <h2>Admin Panel</h2>
  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('registerTab')">Register Tab</button>
    <button class="tab-btn" onclick="showTab('requestTab')">Topup Request Tab</button>
  </div>

  <div id="registerTab" class="tab-content active-tab">
    <table>
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Username</th>
          <th>Phone</th>
          <th>Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <div id="requestTab" class="tab-content">
    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>Phone</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="requestTable"></tbody>
    </table>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyDwqM5xxcw-tX3ZoswIdl4HWVYdf7foNEY",
  authDomain: "bulla-bazar.firebaseapp.com",
  databaseURL: "https://bulla-bazar-default-rtdb.firebaseio.com",
  projectId: "bulla-bazar",
  storageBucket: "bulla-bazar.firebasestorage.app",
  messagingSenderId: "597341196963",
  appId: "1:597341196963:web:af1f2cc7808a9f127d6516"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ðŸ”¹ Tab Switching
    function showTab(id) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active-tab'));
      event.target.classList.add('active');
      document.getElementById(id).classList.add('active-tab');
    }

    // ðŸ”¹ Load Users
    const userTable = document.getElementById('userTable');
    db.ref('users').on('child_added', snapshot => {
      const key = snapshot.key;
      const u = snapshot.val();
      let row = `<tr id="user-${key}">
        <td>${u.fullname}</td>
        <td>${u.username}</td>
        <td>${u.phone}</td>
        <td>${u.time}</td>
        <td><button class="action delete" onclick="deleteUser('${key}')">Delete</button></td>
      </tr>`;
      userTable.innerHTML += row;
    });

    function deleteUser(key){
      if(confirm("Are you sure to delete this user?")){
        db.ref('users/'+key).remove();
        document.getElementById('user-'+key).remove();
      }
    }

    // ðŸ”¹ Load Requests (Step 2 main.html will add)
    const requestTable = document.getElementById('requestTable');
    db.ref('topupRequests').orderByKey().on('child_added', snap => {
      const key = snap.key;
      const r = snap.val();
      alert("New Topup Request Arrived!"); // popup

      let row = `<tr id="req-${key}">
        <td>${r.username}</td>
        <td>${r.phone}</td>
        <td>${r.amount}</td>
        <td id="status-${key}">${r.status}</td>
        <td>
          <button class="action complete" onclick="markComplete('${key}')">Complete</button>
          <button class="action fail" onclick="markFailed('${key}')">Failed</button>
        </td>
      </tr>`;
      requestTable.insertAdjacentHTML('afterbegin', row);
    });

    function markComplete(key){
      db.ref('topupRequests/'+key+'/status').set("Completed");
      document.getElementById('status-'+key).innerText = "Completed";
    }

    function markFailed(key){
      db.ref('topupRequests/'+key+'/status').set("Failed");
      document.getElementById('status-'+key).innerText = "Failed";
    }
  </script>
</body>
    </html>
