<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | BullaTopUp</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {margin:0; font-family:'Poppins',sans-serif; background:#f5f6fa;}
    header {background:linear-gradient(135deg,#FF3B30,#FF5C8D); color:white; padding:15px 20px; font-size:20px; font-weight:600;}
    nav {background:white; display:flex; gap:20px; padding:10px 20px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    nav button {
      padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600;
    }
    nav button.active {background:#FF5C8D; color:white;}
    .container {padding:20px;}
    table {width:100%; border-collapse:collapse; margin-top:15px; background:white; box-shadow:0 4px 12px rgba(0,0,0,0.05);}
    table th, table td {padding:10px; border-bottom:1px solid #eee; text-align:left;}
    table th {background:#f1f1f1;}
    table tr:hover {background:#f9f9f9;}
    .btn {padding:4px 8px; font-size:12px; border:none; border-radius:4px; cursor:pointer;}
    .btn-complete {background:#00C853; color:white;}
    .btn-fail {background:#ff4757; color:white;}
  </style>
</head>
<body>

<header>üîπ Admin Panel</header>

<nav>
  <button id="tabUsers" class="active" onclick="showTab('users')">Registered Users</button>
  <button id="tabPayments" onclick="showTab('payments')">Payments / Topups</button>
</nav>

<div class="container">
  <!-- Users Table -->
  <div id="usersTab">
    <h3>Registered Users</h3>
    <table>
      <thead>
        <tr>
          <th>User ID</th>
          <th>Name</th>
          <th>Username</th>
          <th>Email</th>
          <th>Phone</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <!-- Payments Table -->
  <div id="paymentsTab" style="display:none;">
    <h3>Payment Requests</h3>
    <table>
      <thead>
        <tr>
          <th>Txn ID</th>
          <th>User ID</th>
          <th>Username</th>
          <th>Package</th>
          <th>Amount</th>
          <th>Method</th>
          <th>Status</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="paymentTable"></tbody>
    </table>
  </div>
</div>

<script>
  const userTable = document.getElementById("userTable");
  const paymentTable = document.getElementById("paymentTable");

  let users = JSON.parse(localStorage.getItem("users")) || {};
  let payments = JSON.parse(localStorage.getItem("payments")) || [];

  function loadUsers() {
    userTable.innerHTML = "";
    Object.values(users).forEach(user => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${user.id || "N/A"}</td>
        <td>${user.name || "-"}</td>
        <td>${user.username || "-"}</td>
        <td>${user.email || "-"}</td>
        <td>${user.mobile || "-"}</td>
      `;
      userTable.appendChild(tr);
    });
  }

  function loadPayments() {
    paymentTable.innerHTML = "";
    payments.forEach((p, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index+1}</td>
        <td>${p.userId}</td>
        <td>${p.username || "-"}</td>
        <td>${p.package}</td>
        <td>‡ß≥${p.amount}</td>
        <td>${p.method}</td>
        <td>${p.status}</td>
        <td>${p.date}</td>
        <td>
          ${p.status==="Pending" ? `
            <button class="btn btn-complete" onclick="completePayment(${index})">Complete</button>
            <button class="btn btn-fail" onclick="failPayment(${index})">Fail</button>
          ` : "-"}
        </td>
      `;
      paymentTable.appendChild(tr);
    });
  }

  function completePayment(index) {
    payments[index].status = "Completed";
    localStorage.setItem("payments", JSON.stringify(payments));

    // Add to user's wallet & transaction history
    const mobile = payments[index].mobile;
    if(users[mobile]){
      users[mobile].wallet = (users[mobile].wallet || 0) + payments[index].amount;
      users[mobile].transactions = users[mobile].transactions || [];
      users[mobile].transactions.push({
        package: payments[index].package,
        amount: payments[index].amount,
        method: payments[index].method,
        status: "Completed",
        date: new Date().toLocaleString()
      });
      localStorage.setItem("users", JSON.stringify(users));
    }

    loadPayments();
    alert("‚úÖ Payment marked as Completed & Wallet updated!");
  }

  function failPayment(index) {
    payments[index].status = "Failed";
    localStorage.setItem("payments", JSON.stringify(payments));
    loadPayments();
    alert("‚ùå Payment marked as Failed!");
  }

  function showTab(tab) {
    document.getElementById("usersTab").style.display = tab==="users" ? "block" : "none";
    document.getElementById("paymentsTab").style.display = tab==="payments" ? "block" : "none";
    document.getElementById("tabUsers").classList.toggle("active", tab==="users");
    document.getElementById("tabPayments").classList.toggle("active", tab==="payments");
  }

  loadUsers();
  loadPayments();
</script>

</body>
</html>
