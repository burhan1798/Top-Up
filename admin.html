<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | BullaTopUp</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {margin:0; font-family:'Poppins',sans-serif; background:#f4f5fa;}
    header {background:linear-gradient(135deg,#FF3B30,#FF5C8D); color:white; padding:15px 20px; font-size:22px; font-weight:600;}
    nav {display:flex; gap:15px; padding:10px 20px; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    nav button {padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; background:#eee;}
    nav button.active {background:#FF5C8D; color:white;}
    .container {padding:20px;}
    .card {background:white; padding:15px; margin-bottom:15px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.05);}
    .card h4 {margin:0 0 10px;}
    .actions {margin-top:10px;}
    .btn {padding:6px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin-right:5px;}
    .btn-complete {background:#00C853; color:white;}
    .btn-fail {background:#ff4757; color:white;}
    .status-pending {color:orange; font-weight:600;}
    .status-completed {color:#00C853; font-weight:600;}
    .status-failed {color:#ff4757; font-weight:600;}
  </style>
</head>
<body>

<header>üîπ Admin Panel</header>

<nav>
  <button id="tabUsers" class="active" onclick="showTab('users')">Registered Users</button>
  <button id="tabPayments" onclick="showTab('payments')">Payment Requests</button>
  <button id="tabTopups" onclick="showTab('topups')">Topup Requests</button>
</nav>

<div class="container">
  <div id="usersTab"><h3>Registered Users</h3><div id="usersList"></div></div>
  <div id="paymentsTab" style="display:none;"><h3>Payment Requests</h3><div id="paymentsList"></div></div>
  <div id="topupsTab" style="display:none;"><h3>Topup Requests</h3><div id="topupsList"></div></div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users")) || {};
let payments = JSON.parse(localStorage.getItem("payments")) || [];

const usersList=document.getElementById("usersList");
const paymentsList=document.getElementById("paymentsList");
const topupsList=document.getElementById("topupsList");

function loadUsers(){
  usersList.innerHTML="";
  Object.values(users).forEach(u=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <h4>${u.name||'-'} (${u.username||'-'})</h4>
      <p><b>User ID:</b> ${u.id||'-'} | <b>Email:</b> ${u.email||'-'} | <b>Phone:</b> ${u.mobile||'-'}</p>
      <div class="actions"><button class="btn btn-fail" onclick="deleteUser('${u.mobile}')">Delete User</button></div>`;
    usersList.appendChild(card);
  });
}

function deleteUser(mobile){
  if(confirm("‚ö† ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á User ‡¶ü‡¶ø Delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
    delete users[mobile];
    localStorage.setItem("users",JSON.stringify(users));
    payments=payments.filter(p=>p.mobile!==mobile);
    localStorage.setItem("payments",JSON.stringify(payments));
    alert("‚úÖ User Deleted Successfully!");
    loadUsers(); loadPayments(); loadTopups();
  }
}

function loadPayments(){
  paymentsList.innerHTML="";
  payments.filter(p=>p.type!=="topup").forEach((p,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <h4>ID #${p.id} | ${p.username||'-'} | ‡ß≥${p.amount}</h4>
      <p><b>User ID:</b> ${p.userId} | <b>Mobile:</b> ${p.mobile}</p>
      <p><b>Method:</b> ${p.method} | <b>Status:</b> <span class="status-${p.status.toLowerCase()}">${p.status}</span></p>
      <p><b>Date:</b> ${p.date}</p>
      <div class="actions">
        ${p.status==="Pending"?`
          <button class="btn btn-complete" onclick="completePayment(${i})">Complete</button>
          <button class="btn btn-fail" onclick="failPayment(${i})">Fail</button>
        `:""}
      </div>`;
    paymentsList.appendChild(card);
  });
}

function loadTopups(){
  topupsList.innerHTML="";
  payments.filter(p=>p.type==="topup").forEach((p,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <h4>ID #${p.id} | ${p.username||'-'} | ${p.package} - ‡ß≥${p.amount}</h4>
      <p><b>User ID:</b> ${p.userId} | <b>Mobile:</b> ${p.mobile} | <b>UID:</b> ${p.uid}</p>
      <p><b>Method:</b> ${p.method} | <b>Status:</b> <span class="status-${p.status.toLowerCase()}">${p.status}</span></p>
      <p><b>Date:</b> ${p.date}</p>
      <div class="actions">
        ${p.status==="Pending"?`
          <button class="btn btn-complete" onclick="completeTopup(${i})">Complete</button>
          <button class="btn btn-fail" onclick="failTopup(${i})">Fail</button>
        `:""}
      </div>`;
    topupsList.appendChild(card);
  });
}

function completePayment(i){
  payments[i].status="Completed";
  const mobile=payments[i].mobile;
  if(users[mobile]){
    users[mobile].wallet=(users[mobile].wallet||0)+payments[i].amount;
    localStorage.setItem("users",JSON.stringify(users));
  }
  localStorage.setItem("payments",JSON.stringify(payments));
  loadPayments(); alert("‚úÖ Payment Completed & Wallet Updated");
}

function failPayment(i){
  payments[i].status="Failed";
  localStorage.setItem("payments",JSON.stringify(payments));
  loadPayments(); alert("‚ùå Payment Failed");
}

function completeTopup(i){
  payments[i].status="Completed";
  const mobile=payments[i].mobile;
  if(users[mobile]){
    users[mobile].wallet=0; // wallet reset
    localStorage.setItem("users",JSON.stringify(users));
  }
  localStorage.setItem("payments",JSON.stringify(payments));
  loadTopups(); alert("‚úÖ Topup Completed & Wallet Reset");
}

function failTopup(i){
  payments[i].status="Failed";
  localStorage.setItem("payments",JSON.stringify(payments));
  loadTopups(); alert("‚ùå Topup Failed");
}

function showTab(tab){
  document.getElementById("usersTab").style.display=tab==="users"?"block":"none";
  document.getElementById("paymentsTab").style.display=tab==="payments"?"block":"none";
  document.getElementById("topupsTab").style.display=tab==="topups"?"block":"none";
  document.getElementById("tabUsers").classList.toggle("active",tab==="users");
  document.getElementById("tabPayments").classList.toggle("active",tab==="payments");
  document.getElementById("tabTopups").classList.toggle("active",tab==="topups");
}

loadUsers(); loadPayments(); loadTopups();
</script>

</body>
</html>
