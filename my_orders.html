<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Orders | BullaTopUp</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family:'Poppins',sans-serif;
      margin:0;
      background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
      color:white;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:30px;
    }
    h2 { margin-bottom:20px; animation:fadeIn 1s; }
    @keyframes fadeIn{from{opacity:0;transform:translateY(-10px);} to{opacity:1;transform:translateY(0);}}

    table {
      width:95%; max-width:800px;
      border-collapse: collapse;
      background:rgba(255,255,255,0.1);
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 0 15px rgba(0,0,0,0.5);
      animation: fadeIn 1s;
    }
    th, td {
      padding:12px;
      text-align:center;
    }
    th {
      background:rgba(0,0,0,0.3);
      font-weight:600;
    }
    tr:nth-child(even){background:rgba(255,255,255,0.05);}
    .status-pending {color:orange;font-weight:bold;}
    .status-completed {color:lime;font-weight:bold;}
    .status-failed {color:red;font-weight:bold;}
    .empty {margin-top:40px;font-size:18px;opacity:0.8;}
    /* Bubble Animation */
    #bubbleContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index:1;
    }
    .bubble {
      position: absolute;
      bottom: -100px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,0,150,0.8), rgba(0,150,255,0.6));
      animation: rise 7s linear forwards;
      opacity: 0.85;
      box-shadow:0 0 20px rgba(0,0,0,0.2);
    }
    @keyframes rise {
      0% {transform:translateY(0) scale(0.7); opacity:0.8;}
      50% {opacity:1; transform:translateY(-50vh) scale(1);}
      100% {transform:translateY(-110vh) scale(1.2); opacity:0;}
    }
  </style>
</head>
<body>

<h2>üìú My Orders</h2>
<table>
  <thead>
    <tr>
      <th>Package</th>
      <th>Amount</th>
      <th>Method</th>
      <th>Status</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody id="orderTable"></tbody>
</table>

<div class="empty" id="emptyMsg" style="display:none;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡ßá‡¶á!</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDwqM5xxcw-tX3ZoswIdl4HWVYdf7foNEY",
    authDomain: "bulla-bazar.firebaseapp.com",
    databaseURL: "https://bulla-bazar-default-rtdb.firebaseio.com",
    projectId: "bulla-bazar",
    storageBucket: "bulla-bazar.firebasestorage.app",
    messagingSenderId: "597341196963",
    appId: "1:597341196963:web:af1f2cc7808a9f127d6516"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if(!currentUser){
    alert("Please login first!");
    window.location.href = "login.html";
  }

  const orderTable = document.getElementById("orderTable");
  const emptyMsg = document.getElementById("emptyMsg");

  function renderStatus(status){
    if(status==="Completed") return `<span class="status-completed">Completed</span>`;
    if(status==="Failed") return `<span class="status-failed">Failed</span>`;
    return `<span class="status-pending">Pending</span>`;
  }

  // Listen for current user's orders in realtime
  db.ref("topupRequests")
    .orderByChild("phone")
    .equalTo(currentUser.phone)
    .on("value", snapshot => {
      orderTable.innerHTML="";
      if(!snapshot.exists()){ 
        emptyMsg.style.display="block"; 
        return; 
      }
      emptyMsg.style.display="none";

      const orders = [];
      snapshot.forEach(child => {
        const order = child.val();
        order.id = child.key; // store order ID for reference
        orders.push(order);
      });

      // Sort by time (latest first)
      orders.sort((a,b) => new Date(b.time) - new Date(a.time));

      // Render orders
      orders.forEach(order => {
        const row = `<tr>
          <td>${order.package || "-"}</td>
          <td>‡ß≥${order.amount}</td>
          <td>${order.method}</td>
          <td>${renderStatus(order.status || "Pending")}</td>
          <td>${order.time}</td>
        </tr>`;
        orderTable.insertAdjacentHTML('beforeend', row);
      });
    });

    // Floating Bubble Animation (no money sign)
const bubbleContainer = document.getElementById('bubbleContainer');

function createBubble(){
  const bubble = document.createElement('div');
  bubble.className='bubble';
  const size = Math.random()*50 + 30; // 30-80px
  bubble.style.width = size+'px';
  bubble.style.height = size+'px';
  bubble.style.left = Math.random()*95+'vw';
  bubble.style.animationDuration=(5+Math.random()*3)+'s';
  bubbleContainer.appendChild(bubble);
  setTimeout(()=>{bubble.remove();},9000);
}
setInterval(createBubble,500);
</script>
</body>
  </html>
